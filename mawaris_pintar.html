<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mawaris Pintar - Aplikasi Pembelajaran Ilmu Waris</title>
    <style>
        /* --- Global Styles & Variables --- */
        :root {
            --primary-color: #2c7a7b;
            --secondary-color: #38b2ac;
            --accent-color: #ed8936;
            --background-color: #f7fafc;
            --card-background: #ffffff;
            --text-color: #2d3748;
            --text-light: #718096;
            --border-color: #e2e8f0;
            --success-color: #48bb78;
            --danger-color: #f56565;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* --- Header --- */
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 0;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 1.8rem;
        }

        /* --- Buttons --- */
        .btn {
            display: inline-block;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            text-decoration: none;
            transition: background-color 0.3s, transform 0.2s;
        }

        .btn-primary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--accent-color);
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #dd6b20;
        }

        /* --- Views --- */
        .view {
            display: none;
        }

        .view.active {
            display: block;
            animation: fadeIn 0.4s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Dashboard View --- */
        #dashboard-view h2 {
            margin-bottom: 1.5rem;
            text-align: center;
            color: var(--primary-color);
        }

        .progress-container {
            background-color: var(--border-color);
            border-radius: 10px;
            height: 25px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--success-color);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .chapter-card {
            background-color: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: box-shadow 0.3s, transform 0.3s;
        }

        .chapter-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .chapter-card h3 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .sub-chapter-list {
            list-style: none;
            padding-left: 0;
        }

        .sub-chapter-item {
            padding: 10px;
            border-left: 3px solid transparent;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sub-chapter-item:hover {
            background-color: var(--background-color);
        }
        
        .sub-chapter-item.completed {
            border-left-color: var(--success-color);
            color: var(--success-color);
        }

        .sub-chapter-item a {
            text-decoration: none;
            color: inherit;
            flex-grow: 1;
        }

        .status-icon {
            font-size: 1.2rem;
        }

        /* --- Lesson & Quiz View --- */
        #lesson-view, #quiz-view {
            background-color: var(--card-background);
            padding: 30px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        #lesson-view h2, #quiz-view h2 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .lesson-content {
            margin-bottom: 2rem;
            text-align: justify;
        }

        .lesson-content p, .lesson-content li {
            margin-bottom: 1rem;
        }
        
        .lesson-content ul, .lesson-content ol {
            padding-left: 20px;
        }

        .quiz-question {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
        }

        .quiz-options {
            list-style: none;
        }

        .quiz-option {
            background-color: var(--background-color);
            border: 1px solid var(--border-color);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }

        .quiz-option:hover {
            background-color: #edf2f7;
            border-color: var(--secondary-color);
        }

        .quiz-option.correct {
            background-color: #c6f6d5;
            border-color: var(--success-color);
        }

        .quiz-option.incorrect {
            background-color: #fed7d7;
            border-color: var(--danger-color);
        }
        
        .quiz-option.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        .quiz-result {
            text-align: center;
            padding: 20px;
            font-size: 1.2rem;
        }

        .quiz-result h3 {
            margin-bottom: 1rem;
        }
        
        .navigation-buttons {
            margin-top: 2rem;
            display: flex;
            justify-content: space-between;
        }

    </style>
</head>
<body>

    <header>
        <div class="container">
            <h1>üïå Mawaris Pintar</h1>
        </div>
    </header>

    <main class="container">
        
        <!-- Dashboard View -->
        <div id="dashboard-view" class="view active">
            <h2>üìö Menu Pembelajaran</h2>
            <div class="progress-container">
                <div id="progress-bar" class="progress-bar" style="width: 0%;">0%</div>
            </div>
            <div id="chapter-list"></div>
        </div>

        <!-- Lesson View -->
        <div id="lesson-view" class="view">
            <h2 id="lesson-title"></h2>
            <div id="lesson-content" class="lesson-content"></div>
            <div class="navigation-buttons">
                <button id="back-to-dashboard-lesson" class="btn btn-primary">‚Üê Kembali ke Menu</button>
                <button id="start-quiz-btn" class="btn btn-secondary">Mulai Asesmen ‚Üí</button>
            </div>
        </div>

        <!-- Quiz View -->
        <div id="quiz-view" class="view">
            <h2 id="quiz-title"></h2>
            <div id="quiz-container">
                <p class="quiz-question" id="question-text"></p>
                <ul id="quiz-options" class="quiz-options"></ul>
            </div>
            <div id="quiz-result" class="quiz-result" style="display: none;"></div>
            <div class="navigation-buttons">
                <button id="back-to-dashboard-quiz" class="btn btn-primary" style="display: none;">‚Üê Kembali ke Menu</button>
            </div>
        </div>

    </main>

    <script>
        // --- DATA KURIKULUM & KUIS ---
        const courseData = [
            {
                id: 'bab1',
                title: 'Bab 1: Pendahuluan Ilmu Mawaris',
                subChapters: [
                    {
                        id: 'sub1-1',
                        title: '1.1 Definisi dan Pentingnya Ilmu Mawaris',
                        content: `<p>Ilmu Mawaris (atau Faraidh) adalah cabang ilmu syar\'i yang membahas tentang pembagian harta peninggalan (tirkah) kepada ahli waris yang berhak setelah si mayit meninggal dunia.</p><p>Ilmu ini sangat penting dalam Islam karena beberapa alasan:</p><ul><li><strong>Bagian dari Syariat:</strong> Pembagian warisan telah diatur secara rinci oleh Allah SWT dalam Al-Qur\'an, khususnya di Surah An-Nisa.</li><li><strong>Mencegah Perselisihan:</strong> Dengan aturan yang jelas, ilmu ini mencegah terjadinya konflik dan permusuhan di antara keluarga yang ditinggalkan.</li><li><strong>Menjaga Keadilan:</strong> Memastikan setiap ahli waris mendapatkan haknya sesuai dengan kedudukan dan hubungannya dengan si mayit.</li></ul>`,
                        quiz: { questions: [{ question: "Apa itu Ilmu Mawaris?", options: ["Ilmu tentang pernikahan", "Ilmu hukum pidana", "Ilmu pembagian harta peninggalan", "Ilmu tata cara sholat"], correctAnswer: 2 }, { question: "Surah yang paling banyak membahas warisan adalah?", options: ["Al-Baqarah", "An-Nisa", "Al-Maidah", "Al-Hujurat"], correctAnswer: 1 }] }
                    },
                    {
                        id: 'sub1-2',
                        title: '1.2 Sebab-Sebab Pewarisan',
                        content: `<p>Ada tiga sebab utama seseorang bisa menjadi ahli waris:</p><ol><li><strong>Nasab (Keturunan):</strong> Hubungan kekerabatan karena darah. Contoh: anak, orang tua, saudara.</li><li><strong>Nikah (Pernikahan):</strong> Hubungan suami-istri yang sah secara syar\'i.</li><li><strong>Wala' (Perbudakan):</strong> Hubungan karena pembebasan budak. (Sudah tidak relevan saat ini).</li></ol>`,
                        quiz: { questions: [{ question: "Manakah yang BUKAN sebab pewarisan?", options: ["Nasab", "Nikah", "Wala'", "Hibah"], correctAnswer: 3 }, { question: "Suami atau istri menjadi ahli waris karena sebab?", options: ["Nasab", "Nikah", "Wala'", "Persahabatan"], correctAnswer: 1 }] }
                    }
                ]
            },
            {
                id: 'bab2',
                title: 'Bab 2: Ahli Waris Bagian Tetap (Ashabul Furudh) - Bagian 1',
                subChapters: [
                    {
                        id: 'sub2-1',
                        title: '2.1 Suami dan Istri',
                        content: `<p><strong>Bagian Suami:</strong></p><ul><li><strong>1/2</strong> jika istri tidak meninggalkan anak (atau cucu).</li><li><strong>1/4</strong> jika istri meninggalkan anak (atau cucu).</li></ul><p><strong>Bagian Istri:</strong></p><ul><li><strong>1/4</strong> jika suami tidak meninggalkan anak (atau cucu). Jika istri lebih dari satu, mereka berbagi 1/4 ini.</li><li><strong>1/8</strong> jika suami meninggalkan anak (atau cucu). Jika istri lebih dari satu, mereka berbagi 1/8 ini.</li></ul>`,
                        quiz: { questions: [{ question: "Seorang suami meninggal, meninggalkan istri dan 1 anak laki-laki. Berapa bagian istri?", options: ["1/2", "1/4", "1/8", "Tidak dapat bagian"], correctAnswer: 2 }, { question: "Seorang istri meninggal, meninggalkan suami dan tidak ada anak. Berapa bagian suami?", options: ["1/2", "1/4", "1/8", "1/6"], correctAnswer: 0 }] }
                    },
                    {
                        id: 'sub2-2',
                        title: '2.2 Ayah dan Ibu',
                        content: `<p><strong>Bagian Ibu:</strong></p><ul><li><strong>1/6</strong> jika mayit meninggalkan anak (atau cucu) atau meninggalkan dua saudara kandung atau lebih.</li><li><strong>1/3</strong> jika mayit tidak meninggalkan anak, cucu, dan tidak ada dua saudara kandung atau lebih.</li><li><strong>1/3 dari sisa</strong> jika mayit hanya meninggalkan ayah dan suami/istri. (Ini adalah kasus khusus).</li></ul><p><strong>Bagian Ayah:</strong></p><ul><li><strong>1/6</strong> jika mayit meninggalkan anak laki-laki (atau cucu laki-laki).</li><li><strong>Bagian sisa ('Asabah)</strong> jika mayit tidak meninggalkan anak laki-laki (atau cucu laki-laki).</li></ul>`,
                        quiz: { questions: [{ question: "Seorang meninggal dunia, meninggalkan ibu, ayah, dan seorang anak laki-laki. Berapa bagian ibu?", options: ["1/3", "1/6", "1/8", "Tidak dapat bagian"], correctAnswer: 1 }, { question: "Seorang perempuan meninggal, meninggalkan ayah dan suami. Ayah berperan sebagai?", options: ["Ashabul Furudh dengan bagian 1/6", "Ashabah (pewaris sisa)", "Mahjub (terhalang)", "Tidak mendapat bagian"], correctAnswer: 1 }] }
                    }
                ]
            },
            {
                id: 'bab3',
                title: 'Bab 3: Ahli Waris Bagian Tetap (Ashabul Furudh) - Bagian 2',
                subChapters: [
                    {
                        id: 'sub3-1',
                        title: '3.1 Anak Perempuan',
                        content: `<p><strong>Anak Perempuan Tunggal:</strong></p><ul><li>Mendapat <strong>1/2</strong> jika tidak ada anak laki-laki.</li></ul><p><strong>Dua Anak Perempuan atau Lebih:</strong></p><ul><li>Mendapat <strong>2/3</strong> jika tidak ada anak laki-laki. Mereka berbagi rata 2/3 tersebut.</li></ul><p><strong>Anak Perempuan Bersama Anak Laki-laki:</strong></p><ul><li>Menjadi <strong>'Ashabah</strong> (pewaris sisa), mendapat bagian sisa setelah ahli waris Ashabul Furudh lain mendapat bagian mereka. Bagian anak laki-laki setara dengan bagian dua anak perempuan.</li></ul>`,
                        quiz: { questions: [{ question: "Seorang ayah meninggal, meninggalkan seorang anak perempuan dan seorang anak laki-laki. Anak perempuan mendapat bagian?", options: ["1/2", "1/3", "1/6", "Bagian sisa sebagai Ashabah"], correctAnswer: 3 }, { question: "Seorang ibu meninggal, meninggalkan dua anak perempuan dan suami. Kedua anak perempuan mendapat bagian total?", options: ["1/2", "2/3", "1/4", "1/6"], correctAnswer: 1 }] }
                    },
                    {
                        id: 'sub3-2',
                        title: '3.2 Saudara Kandung Perempuan',
                        content: `<p><strong>Saudara Kandung Perempuan Tunggal:</strong></p><ul><li>Mendapat <strong>1/2</strong> jika tidak ada anak perempuan, saudara seayah perempuan, dan tidak ada anak laki-laki.</li></ul><p><strong>Dua Saudara Kandung Perempuan atau Lebih:</strong></p><ul><li>Mendapat <strong>2/3</strong> jika tidak ada anak perempuan, saudara seayah perempuan, dan tidak ada anak laki-laki.</li></ul><p><strong>Bersama Anak Perempuan:</strong></p><ul><li>Menjadi <strong>'Ashabah</strong> (pewaris sisa) bersama anak perempuan.</li></ul>`,
                        quiz: { questions: [{ question: "Seorang meninggal, meninggalkan seorang saudara kandung perempuan dan seorang ayah. Bagian saudara kandung perempuan adalah?", options: ["1/2", "1/6", "1/3", "Tidak mendapat bagian (Mahjub oleh Ayah)"], correctAnswer: 3 }, { question: "Seorang laki-laki meninggal, meninggalkan dua saudara kandung perempuan dan ibu. Kedua saudara perempuan mendapat bagian total?", options: ["1/2", "2/3", "1/3", "Tidak mendapat bagian"], correctAnswer: 1 }] }
                    }
                ]
            },
            {
                id: 'bab4',
                title: 'Bab 4: Ahli Waris Pewaris Sisa (Asabah)',
                subChapters: [
                    {
                        id: 'sub4-1',
                        title: '4.1 Definisi dan Jenis Asabah',
                        content: `<p><strong>Asabah</strong> (jamak: 'Aashibun) adalah ahli waris yang tidak memiliki bagian tertentu (fardh). Mereka hanya mendapat bagian jika ada harta yang tersisa setelah semua ahli waris Ashabul Furudh menerima bagian mereka. Jika tidak ada sisa, mereka tidak mendapat apa-apa.</p><p>Jenis-jenis Asabah:</p><ol><li><strong>Asabah Binasab (Karena Keturunan):</strong> Ini adalah golongan utama. Contoh: Anak laki-laki, ayah, kakek, saudara laki-laki kandung, paman kandung, dll.</li><li><strong>Asabah Sabab (Karena Sebab):</strong> Hanya satu golongan, yaitu <strong>budak yang telah membebaskan tuannya</strong> (mu'allat).</li></ol>`,
                        quiz: { questions: [{ question: "Siapa yang termasuk Asabah Binasab?", options: ["Anak laki-laki", "Ibu", "Istri", "Anak perempuan tunggal"], correctAnswer: 0 }, { question: "Definisi Asabah adalah ahli waris yang?", options: ["Mendapat bagian 1/6", "Mendapat bagian sisa", "Selalu mendapat bagian terbesar", "Mendapat bagian 1/8"], correctAnswer: 1 }] }
                    },
                    {
                        id: 'sub4-2',
                        title: '4.2 Hirarki Asabah',
                        content: `<p>Jika ada beberapa Asabah, mereka tidak semua mendapat bagian. Ada aturan prioritas (hirarki) yang menentukan siapa yang berhak menjadi Asabah:</p><ol><li><strong>Anak Laki-laki</strong> (dan keturunannya: cucu laki-laki, cicit laki-laki, dst).</li><li><strong>Ayah</strong> (dan kakek, buyut, dst).</li><li><strong>Saudara Laki-laki Kandung</strong> (dan keturunannya).</li><li><strong>Saudara Seayah Laki-laki</strong> (dan keturunannya).</li><li><strong>Paman Kandung</strong> (dan keturunannya).</li><li><strong>Paman Seayah</strong> (dan keturunannya).</li></ol><p>Contoh: Jika ada anak laki-laki, maka ayah dan saudara laki-laki tidak menjadi Asabah (karena anak laki-laki lebih prioritas).</p>`,
                        quiz: { questions: [{ question: "Seorang mayit meninggalkan anak laki-laki, ayah, dan saudara laki-laki kandung. Siapa yang menjadi Asabah?", options: ["Anak laki-laki dan ayah", "Anak laki-laki, ayah, dan saudara laki-laki", "Hanya anak laki-laki", "Hanya ayah"], correctAnswer: 2 }, { question: "Jika tidak ada anak laki-laki dan ayah, siapa yang bisa menjadi Asabah berikutnya?", options: ["Ibu", "Istri", "Saudara laki-laki kandung", "Anak perempuan"], correctAnswer: 2 }] }
                    }
                ]
            },
            {
                id: 'bab5',
                title: 'Bab 5: Praktik Pembagian & Kasus Khusus',
                subChapters: [
                    {
                        id: 'sub5-1',
                        title: '5.1 Masalah Aul (Kekurangan Bagian)',
                        content: `<p><strong>Aul</strong> terjadi ketika jumlah total bagian Ashabul Furudh lebih dari 1 (satu). Akibatnya, bagian masing-masing ahli waris harus dikurangi secara proporsional agar totalnya menjadi 1.</p><p><strong>Contoh Kasus Aul:</strong></p><ul><li>Mayit meninggalkan: Suami (1/4), 2 orang ibu (1/3), dan 2 orang saudara perempuan kandung (2/3).</li><li>Total bagian = 1/4 + 1/3 + 2/3 = 1/4 + 1 = 1 1/4.</li><li>Karena total > 1, terjadi Aul. Semua bagian harus dikurangi.</li></ul>`,
                        quiz: { questions: [{ question: "Kapan terjadi masalah Aul?", options: ["Ketika total bagian kurang dari 1", "Ketika total bagian lebih dari 1", "Ketika tidak ada Asabah", "Ketika mayit tidak punya ahli waris"], correctAnswer: 1 }, { question: "Apa yang dilakukan jika terjadi Aul?", options: ["Membagikan sisa harta kepada Asabah", "Mengurangi bagian Ashabul Furudh secara proporsional", "Menghapus ahli waris dengan bagian paling kecil", "Memberikan semua harta kepada fakir miskin"], correctAnswer: 1 }] }
                    },
                    {
                        id: 'sub5-2',
                        title: '5.2 Masalah Radd (Pengembalian Sisa)',
                        content: `<p><strong>Radd</strong> terjadi ketika jumlah total bagian Ashabul Furudh kurang dari 1, dan tidak ada ahli waris Asabah yang menerima sisa harta. Sisa harta tersebut dikembalikan (dibagikan kembali) kepada para Ashabul Furudh sesuai dengan proporsi bagian masing-masing.</p><p><strong>Contoh Kasus Radd:</strong></p><ul><li>Mayit meninggalkan: Ibu (1/6) dan seorang istri (1/4).</li><li>Total bagian = 1/6 + 1/4 = 2/12 + 3/12 = 5/12.</li><li>Sisa harta = 1 - 5/12 = 7/12.</li><li>Karena tidak ada Asabah, sisa 7/12 ini dibagikan kembali (Radd) kepada ibu dan istri secara proporsional.</li></ul>`,
                        quiz: { questions: [{ question: "Kapan terjadi masalah Radd?", options: ["Ketika total bagian kurang dari 1 dan tidak ada Asabah", "Ketika total bagian lebih dari 1", "Ketika ada Asabah", "Ketika semua ahli waris laki-laki"], correctAnswer: 0 }, { question: "Mayit meninggalkan seorang ibu (1/6) dan seorang anak perempuan (1/2). Apa yang terjadi pada sisa hartanya?", options: ["Diberikan kepada Asabah", "Dibagikan kembali (Radd) kepada ibu dan anak perempuan", "Hilang", "Dibagi rata kepada semua ahli waris"], correctAnswer: 1 }] }
                    }
                ]
            }
        ];

        // --- APLIKASI LOGIKA ---
        
        // State Management
        let currentChapterId = null;
        let currentSubChapterId = null;
        let quizState = {
            questions: [],
            currentQuestionIndex: 0,
            score: 0
        };

        // DOM Elements
        const views = document.querySelectorAll('.view');
        const dashboardView = document.getElementById('dashboard-view');
        const lessonView = document.getElementById('lesson-view');
        const quizView = document.getElementById('quiz-view');

        // Local Storage Helper
        const storage = {
            getProgress: () => {
                const data = localStorage.getItem('mawarisProgress');
                return data ? JSON.parse(data) : {};
            },
            saveProgress: (progress) => {
                localStorage.setItem('mawarisProgress', JSON.stringify(progress));
            },
            markCompleted: (type, id) => {
                const progress = storage.getProgress();
                if (!progress[type]) progress[type] = {};
                progress[type][id] = true;
                storage.saveProgress(progress);
            },
            isCompleted: (type, id) => {
                const progress = storage.getProgress();
                return !!(progress[type] && progress[type][id]);
            }
        };

        // View Management
        function showView(viewId) {
            views.forEach(view => view.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
        }

        // Dashboard Logic
        function renderDashboard() {
            const chapterList = document.getElementById('chapter-list');
            chapterList.innerHTML = '';

            courseData.forEach(chapter => {
                const chapterCard = document.createElement('div');
                chapterCard.className = 'chapter-card';

                const chapterTitle = document.createElement('h3');
                chapterTitle.textContent = chapter.title;
                chapterCard.appendChild(chapterTitle);

                const subChapterList = document.createElement('ul');
                subChapterList.className = 'sub-chapter-list';

                chapter.subChapters.forEach(subChapter => {
                    const listItem = document.createElement('li');
                    listItem.className = 'sub-chapter-item';
                    
                    const isLessonCompleted = storage.isCompleted('lessons', subChapter.id);
                    const isQuizCompleted = storage.isCompleted('quizzes', subChapter.id);
                    
                    if (isLessonCompleted && isQuizCompleted) {
                        listItem.classList.add('completed');
                    }

                    const link = document.createElement('a');
                    link.href = '#';
                    link.textContent = subChapter.title;
                    link.onclick = (e) => {
                        e.preventDefault();
                        showLesson(chapter.id, subChapter.id);
                    };

                    const statusIcon = document.createElement('span');
                    statusIcon.className = 'status-icon';
                    if (isLessonCompleted && isQuizCompleted) {
                        statusIcon.textContent = '‚úÖ';
                    } else {
                        statusIcon.textContent = '‚è≥';
                    }

                    listItem.appendChild(link);
                    listItem.appendChild(statusIcon);
                    subChapterList.appendChild(listItem);
                });

                chapterCard.appendChild(subChapterList);
                chapterList.appendChild(chapterCard);
            });
            
            updateProgressBar();
            showView('dashboard-view');
        }

        function updateProgressBar() {
            const totalSubChapters = courseData.reduce((acc, ch) => acc + ch.subChapters.length, 0);
            const progress = storage.getProgress();
            const completedLessons = Object.keys(progress.lessons || {}).length;
            const completedQuizzes = Object.keys(progress.quizzes || {}).length;
            
            const totalCompletedTasks = completedLessons + completedQuizzes;
            const totalTasks = totalSubChapters * 2;

            const percentage = totalTasks > 0 ? Math.round((totalCompletedTasks / totalTasks) * 100) : 0;
            
            const progressBar = document.getElementById('progress-bar');
            progressBar.style.width = percentage + '%';
            progressBar.textContent = percentage + '%';
        }

        // Lesson Logic
        function showLesson(chapterId, subChapterId) {
            currentChapterId = chapterId;
            currentSubChapterId = subChapterId;

            const chapter = courseData.find(ch => ch.id === chapterId);
            const subChapter = chapter.subChapters.find(sub => sub.id === subChapterId);

            document.getElementById('lesson-title').textContent = subChapter.title;
            document.getElementById('lesson-content').innerHTML = subChapter.content;

            showView('lesson-view');
            storage.markCompleted('lessons', subChapterId);
        }

        // Quiz Logic
        function startQuiz() {
            const chapter = courseData.find(ch => ch.id === currentChapterId);
            const subChapter = chapter.subChapters.find(sub => sub.id === currentSubChapterId);

            quizState.questions = subChapter.quiz.questions;
            quizState.currentQuestionIndex = 0;
            quizState.score = 0;

            document.getElementById('quiz-title').textContent = `Asesmen: ${subChapter.title}`;
            document.getElementById('back-to-dashboard-quiz').style.display = 'none';
            document.getElementById('quiz-result').style.display = 'none';
            document.getElementById('quiz-container').style.display = 'block';
            
            renderQuestion();
            showView('quiz-view');
        }

        function renderQuestion() {
            if (quizState.currentQuestionIndex >= quizState.questions.length) {
                showQuizResult();
                return;
            }

            const question = quizState.questions[quizState.currentQuestionIndex];
            document.getElementById('question-text').textContent = `Pertanyaan ${quizState.currentQuestionIndex + 1}: ${question.question}`;

            const optionsContainer = document.getElementById('quiz-options');
            optionsContainer.innerHTML = '';

            question.options.forEach((option, index) => {
                const li = document.createElement('li');
                li.className = 'quiz-option';
                li.textContent = option;
                li.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(li);
            });
        }

        function selectAnswer(selectedIndex) {
            const question = quizState.questions[quizState.currentQuestionIndex];
            const options = document.querySelectorAll('.quiz-option');
            
            options.forEach(option => option.classList.add('disabled'));

            if (selectedIndex === question.correctAnswer) {
                options[selectedIndex].classList.add('correct');
                quizState.score++;
            } else {
                options[selectedIndex].classList.add('incorrect');
                options[question.correctAnswer].classList.add('correct');
            }

            setTimeout(() => {
                quizState.currentQuestionIndex++;
                renderQuestion();
            }, 1500);
        }

        function showQuizResult() {
            document.getElementById('quiz-container').style.display = 'none';
            document.getElementById('back-to-dashboard-quiz').style.display = 'inline-block';
            
            const resultContainer = document.getElementById('quiz-result');
            resultContainer.style.display = 'block';
            resultContainer.innerHTML = `
                <h3>üéâ Asesmen Selesai!</h3>
                <p>Anda mendapat skor <strong>${quizState.score} dari ${quizState.questions.length}</strong>.</p>
                <p>${quizState.score === quizState.questions.length ? 'Luar biasa! Anda sempurna.' : 'Bagus! Terus belajar untuk hasil yang lebih baik.'}</p>
            `;
            
            storage.markCompleted('quizzes', currentSubChapterId);
        }

        // Event Listeners
        document.getElementById('back-to-dashboard-lesson').onclick = () => renderDashboard();
        document.getElementById('back-to-dashboard-quiz').onclick = () => renderDashboard();
        document.getElementById('start-quiz-btn').onclick = startQuiz;

        // Initial Load
        document.addEventListener('DOMContentLoaded', () => {
            renderDashboard();
        });

    </script>
</body>
</html>