<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mawaris Pintar - Aplikasi Pembelajaran Ilmu Waris</title>
    <style>
        /* --- File: style.css --- */
        /* --- Global Styles & Variables --- */
        :root {
            --primary-color: #2c7a7b;
            --secondary-color: #38b2ac;
            --accent-color: #ed8936;
            --background-color: #f7fafc;
            --card-background: #ffffff;
            --text-color: #2d3748;
            --text-light: #718096;
            --border-color: #e2e8f0;
            --success-color: #48bb78;
            --danger-color: #f56565;
            --warning-color: #ecc94b;
            --info-color: #4299e1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.7;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* --- Header --- */
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 0;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 1.8rem;
        }

        /* --- Buttons --- */
        .btn {
            display: inline-block;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            text-decoration: none;
            transition: background-color 0.3s, transform 0.2s;
            margin: 5px;
        }

        .btn-primary { background-color: var(--secondary-color); color: white; }
        .btn-primary:hover { background-color: var(--primary-color); transform: translateY(-2px); }
        .btn-secondary { background-color: var(--accent-color); color: white; }
        .btn-secondary:hover { background-color: #dd6b20; }
        .btn-success { background-color: var(--success-color); color: white; }
        .btn-warning { background-color: var(--warning-color); color: var(--text-color); }
        .btn-danger { background-color: var(--danger-color); color: white; }
        .btn-info { background-color: var(--info-color); color: white; }
        .btn:disabled { cursor: not-allowed; opacity: 0.5; }

        /* --- Views --- */
        .view { display: none; }
        .view.active { display: block; animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Welcome View --- */
        #welcome-view { text-align: center; padding: 50px 20px; background-color: var(--card-background); border-radius: 8px; margin-top: 50px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        #welcome-view h2 { color: var(--primary-color); margin-bottom: 20px; }
        #user-name-input { padding: 10px; font-size: 1rem; width: 80%; max-width: 300px; border: 1px solid var(--border-color); border-radius: 5px; margin-bottom: 20px; }

        /* --- Dashboard View --- */
        #dashboard-view h2 { margin-bottom: 1.5rem; text-align: center; color: var(--primary-color); }
        .progress-container { background-color: var(--border-color); border-radius: 10px; height: 25px; margin-bottom: 2rem; overflow: hidden; }
        .progress-bar { height: 100%; background-color: var(--success-color); transition: width 0.5s ease; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }
        .chapter-card { background-color: var(--card-background); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; margin-bottom: 1.5rem; box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: box-shadow 0.3s, transform 0.3s; }
        .chapter-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .chapter-card h3 { color: var(--primary-color); margin-bottom: 0.5rem; }
        .sub-chapter-list { list-style: none; padding-left: 0; }
        .sub-chapter-item { padding: 10px; border-left: 3px solid transparent; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; }
        .sub-chapter-item:hover { background-color: var(--background-color); }
        .sub-chapter-item.completed { border-left-color: var(--success-color); color: var(--success-color); }
        .sub-chapter-item a { text-decoration: none; color: inherit; flex-grow: 1; }
        .status-icon { font-size: 1.2rem; }

        /* --- Lesson View --- */
        #lesson-view, #quiz-view { background-color: var(--card-background); padding: 30px; border-radius: 8px; border: 1px solid var(--border-color); }
        #lesson-view h2, #quiz-view h2 { color: var(--primary-color); margin-bottom: 1rem; }
        .lesson-content { margin-bottom: 2rem; text-align: justify; }
        .lesson-content p, .lesson-content li { margin-bottom: 1rem; }
        .lesson-content ul, .lesson-content ol { padding-left: 20px; }
        
        /* --- Example Box Style --- */
        .example-box {
            background-color: #e6fffa;
            border: 1px solid #81e6d9;
            border-left: 5px solid var(--info-color);
            padding: 20px;
            margin-top: 2rem;
            border-radius: 5px;
        }
        .example-box h4 {
            color: var(--info-color);
            margin-bottom: 10px;
        }

        /* --- Quiz View --- */
        .quiz-question { font-size: 1.2rem; font-weight: bold; margin-bottom: 1.5rem; }
        .quiz-options { list-style: none; }
        .quiz-option { background-color: var(--background-color); border: 1px solid var(--border-color); padding: 15px; margin-bottom: 10px; border-radius: 5px; cursor: pointer; transition: background-color 0.2s, border-color 0.2s; }
        .quiz-option:hover { background-color: #edf2f7; border-color: var(--secondary-color); }
        .quiz-option.correct { background-color: #c6f6d5; border-color: var(--success-color); }
        .quiz-option.incorrect { background-color: #fed7d7; border-color: var(--danger-color); }
        .quiz-option.disabled { pointer-events: none; opacity: 0.7; }
        .quiz-result { text-align: center; padding: 20px; font-size: 1.2rem; }
        .quiz-result h3 { margin-bottom: 1rem; }
        .navigation-buttons { margin-top: 2rem; display: flex; justify-content: space-between; }
        #quiz-progress-info { text-align: center; margin-bottom: 20px; font-weight: bold; color: var(--text-light); }
        
        /* --- New Quiz Type Styles --- */
        .quiz-essay textarea { width: 100%; height: 120px; padding: 10px; border-radius: 5px; border: 1px solid var(--border-color); margin-bottom: 10px; }
        .essay-reference { background-color: #f0f4f8; border-left: 4px solid var(--secondary-color); padding: 15px; margin-top: 15px; display: none; }
        .matching-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .matching-item { display: flex; align-items: center; }
        .matching-item label { flex-basis: 100px; }
        .matching-item select { flex-grow: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 5px; }
        .case-study-scenario { background-color: #f7fafc; border: 1px dashed var(--border-color); padding: 20px; margin-bottom: 20px; border-radius: 5px; }
        .case-study-sub-question { margin-top: 15px; padding: 15px; background-color: #edf2f7; border-radius: 5px; }

        /* --- Certificate View --- */
        #certificate-view { background-color: white; border: 10px solid var(--accent-color); padding: 40px; text-align: center; font-family: 'Times New Roman', serif; color: var(--text-color); }
        #certificate-view h1 { font-size: 2.5rem; color: var(--primary-color); margin-bottom: 10px; }
        #certificate-view h2 { font-size: 1.5rem; font-weight: normal; margin-bottom: 30px; }
        .certificate-body { font-size: 1.2rem; line-height: 1.8; margin-bottom: 30px; }
        .certificate-body strong { text-decoration: underline; }
        .certificate-footer { margin-top: 40px; }
        .certificate-footer p { font-size: 1rem; }
        @media print { body * { visibility: hidden; } #certificate-view, #certificate-view * { visibility: visible; } #certificate-view { position: absolute; left: 0; top: 0; width: 100%; border: none; padding: 20px; } .no-print { display: none !important; } }
    </style>
</head>
<body>

    <header>
        <div class="container">
            <h1>üïå Mawaris Pintar</h1>
        </div>
    </header>

    <main class="container">
        <!-- Welcome View -->
        <div id="welcome-view" class="view active">
            <h2>Selamat Datang di Aplikasi Mawaris Pintar!</h2>
            <p>Silakan masukkan nama Anda untuk memulai pembelajaran mendalam Ilmu Mawaris.</p>
            <input type="text" id="user-name-input" placeholder="Ketik nama Anda di sini...">
            <br>
            <button id="start-learning-btn" class="btn btn-primary">Mulai Belajar</button>
        </div>

        <!-- Dashboard View -->
        <div id="dashboard-view" class="view">
            <h2>üìö Menu Pembelajaran</h2>
            <div class="progress-container">
                <div id="progress-bar" class="progress-bar" style="width: 0%;">0%</div>
            </div>
            <div id="chapter-list"></div>
            <div id="certificate-button-container" style="text-align: center; margin-top: 20px; display: none;">
                <button id="view-certificate-btn" class="btn btn-success">üéâ Lihat Sertifikat Anda</button>
            </div>
        </div>

        <!-- Lesson View -->
        <div id="lesson-view" class="view">
            <h2 id="lesson-title"></h2>
            <div id="lesson-content" class="lesson-content"></div>
            <div class="navigation-buttons">
                <button id="back-to-dashboard-lesson" class="btn btn-primary">‚Üê Kembali ke Menu</button>
                <button id="start-quiz-btn" class="btn btn-secondary">Mulai Asesmen ‚Üí</button>
            </div>
        </div>

        <!-- Quiz View -->
        <div id="quiz-view" class="view">
            <h2 id="quiz-title"></h2>
            <div id="quiz-progress-info" style="text-align: center; margin-bottom: 20px; font-weight: bold;"></div>
            <div id="quiz-container">
                <p class="quiz-question" id="question-text"></p>
                <ul id="quiz-options" class="quiz-options"></ul>
                <div id="quiz-essay-container" class="quiz-essay" style="display: none;"></div>
                <div id="quiz-matching-container" class="quiz-matching" style="display: none;"></div>
                <div id="quiz-case-study-container" class="quiz-case-study" style="display: none;"></div>
            </div>
            <div id="quiz-result" class="quiz-result" style="display: none;"></div>
            <div class="navigation-buttons">
                <button id="back-to-dashboard-quiz" class="btn btn-primary" style="display: none;">‚Üê Kembali ke Menu</button>
            </div>
        </div>

        <!-- Certificate View -->
        <div id="certificate-view" class="view">
            <h1>SERTIFIKAT</h1>
            <h2>Pencapaian Pembelajaran Ilmu Mawaris</h2>
            <div class="certificate-body">
                <p>Dengan ini menyatakan bahwa</p>
                <p><strong id="certificate-name"></strong></p>
                <p>telah berhasil menyelesaikan seluruh materi dan asesmen pada aplikasi "Mawaris Pintar" dengan hasil yang sangat memuaskan.</p>
                <p>Nilai Akhir: <strong id="certificate-score"></strong></p>
            </div>
            <div class="certificate-footer">
                <p>Dikeluarkan pada: <span id="certificate-date"></span></p>
            </div>
            <div class="no-print" style="margin-top: 30px;">
                <button id="print-certificate-btn" class="btn btn-secondary">Cetak Sertifikat</button>
                <button id="back-to-dashboard-cert" class="btn btn-primary">Kembali ke Menu</button>
            </div>
        </div>

    </main>

    <script>
        // --- File: script.js ---
        // --- DATA KURIKULUM, MATERI LENGKAP, & KUIS HOTS ---
        const courseData = [
            {
                id: 'bab1', title: 'Bab 1: Konsep Dasar Ilmu Mawaris',
                subChapters: [
                    {
                        id: 'sub1-1', title: '1.1 Definisi, Pentingnya, dan Dasar Hukum',
                        content: `<p><strong>Definisi Ilmu Mawaris (Faraidh):</strong> Secara bahasa, 'faraidh' adalah jamak dari 'faridhah' yang berarti bagian yang ditentukan. Secara istilah, Ilmu Mawaris adalah cabang ilmu syar'i yang mempelajari tentang siapa yang berhak menerima harta peninggalan (tirkah), berapa bagian masing-masing, dan siapa yang terhalang (mahjub) dari warisan setelah si mayit meninggal dunia.</p><p><strong>Pentingnya Ilmu Mawaris:</strong> Nabi Muhammad SAW bersabda: "Pelajarilah ilmu warisan, karena ia adalah separuh dari ilmu, dan ia akan dilupakan, maka ia akan menjadi yang pertama kali diangkat dari umatku." (HR. Ibnu Majah). Pentingnya karena: <strong>Keadilan Sosial</strong>, <strong>Stabilitas Keluarga</strong>, <strong>Implementasi Syariat</strong>, dan <strong>Kesejahteraan Ekonomi</strong>.</p><p><strong>Dasar Hukum Utama:</strong> <strong>Al-Qur'an</strong> (Surah An-Nisa' ayat 11, 12, 176), <strong>As-Sunnah (Hadis)</strong>, <strong>Ijma' (Konsensus Ulama)</strong>, dan <strong>Qiyas (Analogi)</strong>.</p><div class="example-box"><h4>üìñ Contoh Kasus Sebelum Asesmen</h4><p><strong>Skenario:</strong> Pak Ahmad meninggal dunia. Ia memiliki seorang istri, dua anak laki-laki, dan seorang ayah. Sebelum meninggal, ia menuliskan wasiat bahwa seluruh hartanya (senilai 2 Miliar) harus diberikan kepada kedua anak laki-lakinya karena dianggap lebih siap mengelola bisnis.</p><p><strong>Analisis:</strong> Wasiat Pak Ahmad tidak sah sepenuhnya. Hukum Islam membatasi wasiat maksimal 1/3 dari total harta, dan itu pun tidak boleh merugikan hak ahli waris yang sudah ditetapkan (Ashabul Furudh). Istri dan ayah Pak Ahmad adalah ahli waris Ashabul Furudh yang berhak mendapat bagian. Wasiat yang melebihi 1/3 atau merugikan mereka adalah bathal (batal).</p></div>`,
                        quiz: { questions: [
                            { type: 'multiple-choice', question: "Mengapa hukum waris Islam dianggap lebih unggul dalam menjaga stabilitas sosial dibandingkan sistem waris lain seperti testamen bebas?", options: ["Karena lebih fleksibel dan cepat", "Karena adil, terperinci, dan menjamin hak setiap ahli waris, mencegah dominasi satu pihak", "Karena sesuai dengan hukum negara modern", "Karena hanya berlaku untuk orang kaya"], correctAnswer: 1 },
                            { type: 'essay', question: "Jelaskan dampak sosial yang mungkin terjadi dalam sebuah masyarakat jika aturan waris Islam (Ilmu Mawaris) diabaikan dan digantikan oleh keinginan pribadi semata (testamen tanpa batasan)!", referenceAnswer: "Jawaban acuan: Dampaknya bisa sangat negatif. Potensi terjadi perselisihan keluarga yang hebat, permusuhan, dan ketidakadilan. Ahli waris yang lemah (seperti anak perempuan atau istri) mungkin tidak mendapatkan haknya. Harta bisa terkonsentrasi pada satu orang yang mungkin tidak bertanggung jawab, sementara ahli waris lain yang membutuhkan tidak mendapatkan apa-apa. Ini bisa mengancam keharmonisan sosial dan ekonomi keluarga." },
                            { type: 'matching', question: "Jodohkan istilah dengan penjelasannya!", pairs: [{ term: "Faraidh", match: "Ilmu tentang pembagian harta waris" }, { term: "Tirkah", match: "Harta peninggalan yang ditinggalkan" }, { term: "Waris", match: "Ahli waris yang berhak menerima" }, { term: "Hijb (Pewarisan)", match: "Hal yang menyebabkan seseorang tidak mendapat bagian" }, { term: "Radd", match: "Pengembalian sisa harta kepada Ashabul Furudh" }, { term: "'Aul", match: "Pengurangan bagian karena total bagian Ashabul Furudh lebih dari 1" }, { term: "'Asabah", match: "Ahli waris yang mendapat sisa harta" }, { term: "Wasiat", match: "Amanah yang diberikan setelah kematian, maksimal 1/3 harta" }] },
                            { type: 'case-study', scenario: "Seorang ayah meninggal dunia. Ia memiliki harta yang cukup besar. Ia meninggalkan seorang istri, dua anak laki-laki, dan seorang anak perempuan. Sebelum meninggal, ia sempat menulis surat wasiat bahwa seluruh hartanya ingin diberikan kepada anak laki-laki pertama karena dianggap paling mampu mengelola bisnis keluarga.", questions: [
                                { type: 'multiple-choice', question: "Berdasarkan hukum waris Islam, apakah wasiat ayah tersebut sah secara penuh?", options: ["Sah, karena itu adalah haknya sebagai pemilik harta", "Tidak sah, karena wasiat tidak boleh melebihi 1/3 harta dan tidak boleh merugikan ahli waris Ashabul Furudh", "Sah, asalkan disetujui oleh semua ahli waris", "Tidak sah, karena wasiat hanya boleh diberikan kepada orang di luar ahli waris"], correctAnswer: 1 },
                                { type: 'essay', question: "Analisislah potensi konflik yang bisa muncul dari skenario di atas jika wasiat tersebut dipaksakan. Bagaimana hukum waris Islam mencegah hal ini?", referenceAnswer: "Jawaban acuan: Konflik pasti terjadi. Istri dan anak perempuan akan merasa dizalimi. Anak laki-laki kedua mungkin merasa tidak adil. Ini bisa memecah belah keluarga. Hukum waris Islam mencegahnya dengan menetapkan bagian yang pasti dan adil untuk istri, anak laki-laki, dan anak perempuan. Anak laki-laki pertama tetap bisa mendapat bagian (sebagai 'ashabah) yang besar, tapi tidak seluruhnya, sehingga hak ahli waris lain tetap terlindungi." }
                            ]},
                            { type: 'multiple-choice', question: "Dalil utama pembagian warisan paling rinci terdapat dalam surah...", options: ["Al-Baqarah", "Ali 'Imran", "An-Nisa'", "Al-Ma'idah"], correctAnswer: 2 },
                            { type: 'essay', question: "Jelaskan perbedaan antara 'ijma' dan 'qiyas' sebagai sumber hukum dalam Ilmu Mawaris, berikan contoh kasus untuk masing-masing!", referenceAnswer: "Jawaban acuan: 'Ijma' adalah kesepakatan para ulama pada suatu masa terhadap suatu hukum. Contoh: para sahabat sepakat bahwa kakek mendapat bagian seperenam (1/6) bersama-sama dengan saudara perempuan. 'Qiyas' adalah menetapkan hukum suatu masalah yang tidak ada nashnya dengan menyamakannya pada masalah lain yang ada nashnya karena kesamaan 'illat (sebab). Contoh: pembagian harta untuk nenek (ibu dari ayah atau ibu) diqiyaskan dengan bagian kakek karena keduanya memiliki sebab yang sama, yaitu nasab." },
                            { type: 'multiple-choice', question: "Syarat agar wasiat bisa dilaksanakan adalah...", options: ["Pewasiat sudah dewasa dan berakal sehat saat membuat wasiat", "Wasiat ditulis di atas kertas meterai", "Wasiat harus disetujui oleh semua ahli waris", "Pewasiat harus dalam kondisi sekarat"], correctAnswer: 0 },
                            { type: 'essay', question: "Seorang muslim meninggal dunia tanpa meninggalkan ahli waris sama sekali (baik kerabat dekat maupun jauh). Menurut hukum Islam, bagaimana nasib hartanya? Jelaskan dasar hukumnya!", referenceAnswer: "Jawaban acuan: Hartanya menjadi milik negara (baitul mal) untuk kepentingan umum. Ini adalah pendapat jumhur ulama. Dasarnya adalah hadis Rasulullah SAW: 'Aku adalah pewaris bagi orang yang tidak memiliki pewaris. Aku mewarisi hartanya dan ahli warisku adalah seluruh kaum muslimin.' (HR. Abu Dawud dan Tirmidzi). Harta tersebut kemudian dapat digunakan untuk kepentingan sosial seperti fakir miskin, jalan, atau fasilitas umum lainnya." },
                            { type: 'matching', question: "Jodohkan ahli waris dengan sebab kematian yang paling umum terjadi!", pairs: [{ term: "Waris", match: "Ahli waris" }, { term: "Mayyit", match: "Orang yang meninggal dunia" }, { term: "Tirkah", match: "Harta peninggalan" }, { term: "Faraidh", match: "Pembagian harta waris" }] }
                        ]}
                    }
                ]
            },
            {
                id: 'bab2', title: 'Bab 2: Ahli Waris Bagian Tetap (Ashabul Furudh) - Bagian 1',
                subChapters: [
                    {
                        id: 'sub2-1', title: '2.1 Suami, Istri, Ayah, dan Ibu',
                        content: `<p><strong>1. Suami:</strong> Suami selalu mendapat bagian. <strong>1/2</strong> jika istri tidak meninggalkan anak (atau cucu). <strong>1/4</strong> jika istri meninggalkan anak (atau cucu).</p><p><strong>2. Istri:</strong> <strong>1/4</strong> jika suami tidak meninggalkan anak. Jika lebih dari satu istri, mereka berbagi 1/4 ini. <strong>1/8</strong> jika suami meninggalkan anak. Jika lebih dari satu istri, mereka berbagi 1/8 ini.</p><p><strong>3. Ayah:</strong> <strong>1/6</strong> jika mayit meninggalkan anak laki-laki (atau cucu laki-laki). <strong>'Asabah</strong> (ahli waris sisa) jika mayit tidak meninggalkan anak laki-laki (atau cucu laki-laki).</p><p><strong>4. Ibu:</strong> <strong>1/6</strong> jika mayit meninggalkan anak (atau cucu) atau meninggalkan dua saudara kandung atau lebih. <strong>1/3</strong> jika mayit tidak meninggalkan anak, cucu, dan tidak ada dua saudara kandung atau lebih. <strong>1/3 dari sisa</strong> jika mayit hanya meninggalkan ayah dan suami/istri (kasus 'asysyarthan).</p><div class="example-box"><h4>üìñ Contoh Kasus Sebelum Asesmen</h4><p><strong>Skenario:</strong> Seorang laki-laki meninggal dunia. Ia meninggalkan: seorang istri, seorang ayah, seorang ibu, dan seorang anak perempuan. Total hartanya Rp 600 juta.</p><p><strong>Analisis:</strong> Istri (1/8), Ayah ('Asabah), Ibu (1/6), Anak Perempuan ('Asabah). Total bagian Furudh = 1/8 + 1/6 = 11/24. Sisa harta untuk 'Asabah = 1 - 11/24 = 13/24. Sisa harta (13/24) dibagikan kepada 'Asabah (Ayah dan Anak Perempuan) dengan perbandingan 2:1. Ayah mendapat (2/3) dari sisa, dan Anak Perempuan mendapat (1/3) dari sisa.</p></div>`,
                        quiz: { questions: [
                            { type: 'multiple-choice', question: "Seorang laki-laki meninggal dunia, meninggalkan istri, ayah, ibu, dan dua anak perempuan. Berapa bagian ibu?", options: ["1/6", "1/3", "1/3 dari sisa", "Tidak mendapat bagian"], correctAnswer: 0 },
                            { type: 'essay', question: "Jelaskan alasan logis di balik bagian ayah yang bisa menjadi 'ashabah (pewaris sisa) jika tidak ada anak laki-laki, padahal ia termasuk Ashabul Furudh!", referenceAnswer: "Jawaban acuan: Ayah memiliki peran ganda: sebagai orang tua dan sebagai pewaris laki-laki terdekat. Jika si mayit meninggalkan anak laki-laki, maka anak tersebut mewakili garis keturunan ayah, sehingga ayah hanya berperan sebagai orang tua dengan bagian 1/6. Jika tidak ada anak laki-laki, ayah berperan sebagai pewaris laki-laki utama (pengganti si mayit) yang menjamin kelangsungan garis keturunan, sehingga ia berhak atas sisa harta setelah ahli waris lain (yang bukan 'ashabah) mendapat bagian." },
                            { type: 'matching', question: "Jodohkan ahli waris dengan syarat mendapat bagian terbesarnya!", pairs: [{ term: "Suami", match: "Jika istri tidak meninggalkan anak atau cucu" }, { term: "Istri (jika hanya satu)", match: "Jika suami tidak meninggalkan anak atau cucu" }, { term: "Ibu", match: "Jika mayit tidak meninggalkan anak, cucu, dan tidak ada dua saudara kandung atau lebih" }, { term: "Ayah", match: "Jika mayit tidak meninggalkan anak laki-laki (menjadi 'ashabah)" }] },
                            { type: 'case-study', scenario: "Bu Siti meninggal dunia. Ia meninggalkan suami, seorang ayah yang sudah lanjut usia, dan seorang ibu. Ibu Bu Siti butuh biaya pengobatan yang mahal.", questions: [
                                { type: 'multiple-choice', question: "Siapa yang mendapat bagian terbesar dari harta Bu Siti?", options: ["Suami", "Ayah", "Ibu", "Sama besar"], correctAnswer: 0 },
                                { type: 'essay', question: "Hitunglah bagian masing-masing ahli waris. Jika total harta adalah Rp300 juta, berapa nilai yang diterima ibu Bu Siti? Apakah menurut Anda pembagian ini adil mengingat kebutuhan ibunya?", referenceAnswer: "Jawaban acuan: Suami mendapat 1/2 (Rp 150 juta). Ayah mendapat 1/6 (Rp 50 juta). Ibu mendapat 1/6 (Rp 50 juta). Sisa 1/6 (Rp 50 juta) dikembalikan (Radd) kepada ketiganya secara proporsional. Total bagian ibu = 1/6 + (1/6 * 1/4) = 5/24. Nilainya = 5/24 * 300 juta = Rp 62.500.000. Dari sudut pandang syariat, pembagian ini adalah yang paling adil karena telah ditetapkan oleh Allah. Keluarga seharusnya saling membantu, terutama suami, untuk menutupi kekurangan biaya pengobatan ibu." }
                            ]},
                            { type: 'multiple-choice', question: "Seorang perempuan meninggal, meninggalkan suami dan ibu, tanpa anak dan ayah. Ibu mendapat bagian...", options: ["1/3", "1/6", "1/3 dari sisa", "Tidak mendapat bagian"], correctAnswer: 0 },
                            { type: 'essay', question: "Apa yang dimaksud dengan 'asysyarthan'? Berikan contoh perhitungannya!", referenceAnswer: "Jawaban acuan: 'Asysyarthan' adalah kasus khusus di mana seorang mayit hanya meninggalkan suami, istri, dan ayah (atau ibu). Dalam kasus ini, bagian ibu (atau ayah) bukan 1/3, melainkan 1/3 dari sisa harta setelah suami/istri mengambil bagian. Contoh: Mayit meninggalkan suami (1/2), ibu, dan ayah. Sisa setelah suami = 1 - 1/2 = 1/2. Bagian ibu = 1/3 dari sisa = 1/3 * 1/2 = 1/6. Ayah mendapat sisanya = 1/2 - 1/6 = 1/3." },
                            { type: 'multiple-choice', question: "Jika seorang mayit meninggalkan suami, ayah, dan dua orang saudara kandung perempuan, bagian ayah adalah...", options: ["1/6", "1/3", "'Asabah (sisa)", "Tidak mendapat bagian"], correctAnswer: 2 },
                            { type: 'essay', question: "Bandingkan kedudukan ayah dan kakek dalam pembagian waris. Kapan kakek bisa mendapat bagian dan kapan ia terhalang?", referenceAnswer: "Jawaban acuan: Ayah lebih kuat dari kakek. Kakek hanya mendapat bagian jika ayah tidak ada. Jika ayah ada, kakek terhalang (mahjub) sama sekali. Jika ayah tidak ada, kakek berperan menempati posisi ayah. Jika ada anak laki-laki, kakek mendapat 1/6. Jika tidak ada anak laki-laki, kakek menjadi 'ashabah." },
                            { type: 'matching', question: "Jodohkan kasus dengan bagian ibu yang tepat!", pairs: [{ term: "Mayit meninggalkan suami dan anak laki-laki", match: "1/6" }, { term: "Mayit meninggalkan suami dan ayah", match: "1/3 dari sisa" }, { term: "Mayit meninggalkan suami, ayah, dan 2 saudara kandung", match: "1/6" }, { term: "Mayit meninggalkan suami saja", match: "1/4" }] },
                            { type: 'case-study', scenario: "Seorang laki-laki meninggal dunia. Ahli warisnya: seorang istri, seorang ibu, dan seorang anak perempuan. Ternyata setelah dihitung, total bagian Ashabul Furudh adalah 7/8.", questions: [
                                { type: 'multiple-choice', question: "Apa yang terjadi dengan sisa 1/8 harta tersebut?", options: ["Diberikan kepada 'ashabah", "Dibagikan kembali (Radd) kepada istri, ibu, dan anak perempuan", "Menjadi milik negara (baitul mal)", "Hilang"], correctAnswer: 1 },
                                { type: 'essay', question: "Bagaimana cara menghitung bagian masing-masing ahli waris setelah Radd? Jelaskan proporsinya!", referenceAnswer: "Jawaban acuan: Sisa harta (1/8) dibagikan kembali (Radd) kepada para Ashabul Furudh yang ada secara proporsional sesuai bagian masing-masing. Proporsi pembagian Radd adalah: Istri (1/8), Ibu (1/6), Anak Perempuan (1/2). Total proporsi = 3/24 + 4/24 + 12/24 = 19/24. Istri mendapat (3/19) dari sisa, Ibu (4/19) dari sisa, Anak Perempuan (12/19) dari sisa. Jadi bagian akhir istri = 1/8 + (3/19 * 1/8), ibu = 1/6 + (4/19 * 1/8), anak perempuan = 1/2 + (12/19 * 1/8)." }
                            ]}
                        ]}
                    }
                ]
            },
            {
                id: 'bab3', title: 'Bab 3: Ahli Waris Bagian Tetap (Ashabul Furudh) - Bagian 2',
                subChapters: [
                    {
                        id: 'sub3-1', title: '3.1 Anak Perempuan dan Saudara Kandung Perempuan',
                        content: `<p><strong>Anak Perempuan:</strong> <strong>Anak Perempuan Tunggal:</strong> Mendapat <strong>1/2</strong> harta jika tidak ada anak laki-laki. <strong>Dua Anak Perempuan atau Lebih:</strong> Mendapat <strong>2/3</strong> harta jika tidak ada anak laki-laki. <strong>Bersama Anak Laki-laki:</strong> Menjadi <strong>'Ashabah</strong>, bagian anak laki-laki setara dengan bagian dua anak perempuan.</p><p><strong>Saudara Kandung Perempuan:</strong> <strong>Saudara Kandung Perempuan Tunggal:</strong> Mendapat <strong>1/2</strong> jika tidak ada anak perempuan, saudara seayah perempuan, dan tidak ada anak laki-laki. <strong>Dua Saudara Kandung Perempuan atau Lebih:</strong> Mendapat <strong>2/3</strong> jika tidak ada anak perempuan, saudara seayah perempuan, dan tidak ada anak laki-laki. <strong>Bersama Anak Perempuan:</strong> Menjadi <strong>'Ashabah</strong> bersama anak perempuan.</p><p><strong>Prinsip Penting:</strong> Kehadiran anak perempuan akan <strong>menghalangi (hijb)</strong> saudara kandung perempuan untuk mendapat bagian 1/2 atau 2/3.</p><div class="example-box"><h4>üìñ Contoh Kasus Sebelum Asesmen</h4><p><strong>Skenario 1:</strong> Seorang ayah meninggal, meninggalkan seorang anak laki-laki dan dua anak perempuan. <strong>Analisis 1:</strong> Anak laki-laki dan kedua anak perempuan adalah 'ashabah. Seluruh harta dibagikan dengan perbandingan 1:2. <strong>Hasil 1:</strong> Anak laki-laki mendapat 1/3 harta. Setiap anak perempuan mendapat 1/3 harta.</p><p><strong>Skenario 2:</strong> Seorang ayah meninggal, meninggalkan seorang istri, seorang anak perempuan, dan seorang saudara kandung perempuan. <strong>Analisis 2:</strong> Istri mendapat 1/8. Karena ada anak perempuan, ia menjadi 'ashabah. Saudara kandung perempuan juga menjadi 'ashabah yang membantunya. Sisa harta setelah istri (7/8) dibagikan kepada anak perempuan dan saudara kandung perempuan dengan perbandingan 2:1.</p></div>`,
                        quiz: { questions: [
                            { type: 'multiple-choice', question: "Seorang ayah meninggal, meninggalkan seorang anak perempuan dan seorang anak laki-laki. Anak perempuan mendapat bagian?", options: ["1/2", "1/3", "1/6", "Bagian sisa sebagai Ashabah"], correctAnswer: 3 },
                            { type: 'essay', question: "Jelaskan hikmah di balik aturan 'bagian anak laki-laki setara dengan dua anak perempuan'. Mengapa aturan ini dianggap adil dalam konteks tanggung jawab sosial dan ekonomi Islam?", referenceAnswer: "Jawaban acuan: Hikmah aturan ini terkait dengan kewajiban dan tanggung jawab. Dalam Islam, anak laki-laki (suami) dibebani kewajiban untuk memberikan nafkah (mahar, maskawin) kepada istrinya dan bertanggung jawab atas seluruh kebutuhan finansial keluarga (istri dan anak-anaknya). Sementara itu, anak perempuan tidak dibebani kewajiban serupa; bahkan hartanya sendiri adalah haknya sepenuhnya. Untuk memenuhi tanggung jawab finansial yang lebih besar ini, anak laki-laki diberikan bagian waris yang lebih besar." },
                            { type: 'matching', question: "Jodohkan situasi dengan bagian yang tepat untuk saudara kandung perempuan!", pairs: [{ term: "Satu saudara kandung perempuan, tanpa anak perempuan dan anak laki-laki", match: "1/2" }, { term: "Dua saudara kandung perempuan, tanpa anak perempuan dan anak laki-laki", match: "2/3" }, { term: "Satu saudara kandung perempuan, bersama satu anak perempuan", match: "'Ashabah (bagian sisa)" }, { term: "Satu saudara kandung perempuan, bersama satu anak laki-laki", match: "Tidak mendapat bagian (terhalang oleh anak laki-laki)" }] },
                            { type: 'case-study', scenario: "Pak Budi meninggal dunia. Ia meninggalkan seorang istri, seorang ibu, seorang anak perempuan dari istri pertama (sudah meninggal), dan seorang saudara kandung perempuan.", questions: [
                                { type: 'multiple-choice', question: "Siapa yang termasuk Ashabul Furudh dalam kasus ini?", options: ["Istri, Ibu, Anak Perempuan", "Istri, Ibu", "Istri, Ibu, Saudara Kandung Perempuan", "Hanya Istri dan Ibu"], correctAnswer: 0 },
                                { type: 'essay', question: "Hitunglah bagian masing-masing ahli waris. Jelaskan mengapa saudara kandung perempuan mendapat bagian, dan berapa besar bagian tersebut relatif terhadap anak perempuan!", referenceAnswer: "Jawaban acuan: 1. Tentukan bagian Ashabul Furudh: Istri (1/8), Ibu (1/6). Anak Perempuan dan Saudara Kandung Perempuan adalah 'ashabah. 2. Hitung total bagian Furudh: 1/8 + 1/6 = 7/24. 3. Sisa harta untuk 'ashabah: 1 - 7/24 = 17/24. 4. Bagikan sisa kepada 'ashabah (Anak Perempuan dan Saudara Kandung Perempuan) dengan perbandingan 2:1. Total bagian 'ashabah =3. Anak Perempuan mendapat (2/3) dari sisa = 2/3 * 17/24 = 34/72. Saudara Kandung Perempuan mendapat (1/3) dari sisa = 1/3 * 17/24 = 17/72. Saudara kandung perempuan mendapat bagian karena ia membantu anak perempuan sebagai 'ashabah. Bagiannya setengah dari bagian anak perempuan." }
                            ]},
                            { type: 'multiple-choice', question: "Seorang mayit meninggalkan dua anak perempuan dan seorang saudara kandung perempuan. Bagian saudara kandung perempuan adalah...", options: ["1/6", "1/3", "'Asabah", "Tidak mendapat bagian (terhalang oleh dua anak perempuan)"], correctAnswer: 3 },
                            { type: 'essay', question: "Apa beda antara saudara kandung perempuan (akhwat syaqiqah) dan saudara seayah perempuan (akhwat li-ab) dalam hukum waris? Kapan saudara seayah perempuan mendapat bagian?", referenceAnswer: "Jawaban acuan: Saudara kandung perempuan memiliki ayah dan ibu yang sama dengan si mayit. Saudara seayah perempuan hanya memiliki ayah yang sama. Saudara seayah perempuan lebih lemah kedudukannya. Ia hanya mendapat bagian (1/6) jika ia sendirian dan tidak ada anak perempuan, saudara kandung perempuan, dan tidak ada anak laki-laki. Jika ada saudara kandung perempuan, ia tidak mendapat bagian. Ia juga menjadi 'ashabah bersama anak perempuan." },
                            { type: 'multiple-choice', question: "Seorang laki-laki meninggal, meninggalkan seorang istri, seorang anak perempuan, dan seorang saudara seayah perempuan. Bagian saudara seayah perempuan adalah...", options: ["1/6", "'Asabah", "Tidak mendapat bagian", "1/3"], correctAnswer: 1 },
                            { type: 'essay', question: "Jelaskan konsep 'hijb ma'nawi' (penghalangan tidak langsung) yang dialami oleh saudara perempuan ketika ada anak perempuan!", referenceAnswer: "Jawaban acuan: 'Hijb ma'nawi' bukan berarti saudara perempuan sama sekali tidak berhak, tetapi haknya untuk mendapat bagian tertentu (seperti 1/2 atau 2/3) menjadi tidak berlaku karena keberadaan pihak yang lebih kuat (anak perempuan). Anak perempuan adalah ahli waris nasab yang lebih dekat. Namun, saudara perempuan tidak sepenuhnya terbuang, karena ia bisa 'naik kelas' menjadi 'ashabah bersama anak perempuan." },
                            { type: 'matching', question: "Jodohkan istilah saudara perempuan dengan definisinya!", pairs: [{ term: "Akhwat Syaqiqah", match: "Saudara kandung perempuan (satu ayah, satu ibu)" }, { term: "Akhwat li-Ab", match: "Saudara seayah perempuan (satu ayah, beda ibu)" }, { term: "Akhwat li-Umm", match: "Saudara seibu perempuan (beda ayah, satu ibu)" }, { term: "Hijb", match: "Penghalangan ahli waris" }] },
                            { type: 'case-study', scenario: "Seorang wanita meninggal dunia. Ahli warisnya: seorang suami, seorang ayah, seorang saudara kandung perempuan, dan seorang saudara seayah perempuan.", questions: [
                                { type: 'multiple-choice', question: "Siapa yang mendapat bagian 1/6 dalam kasus ini?", options: ["Saudara kandung perempuan", "Saudara seayah perempuan", "Ayah", "Tidak ada yang mendapat 1/6"], correctAnswer: 2 },
                                { type: 'essay', question: "Jelaskan nasib (bagian) dari saudara kandung perempuan dan saudara seayah perempuan dalam kasus ini. Mengapa keduanya berbeda nasibnya?", referenceAnswer: "Jawaban acuan: Karena tidak ada anak perempuan, maka saudara kandung perempuan dan saudara seayah perempuan berpeluang mendapat bagian. Namun, saudara kandung perempuan lebih kuat. Ia akan mendapat bagian 1/6. Karena saudara kandung perempuan sudah mendapat bagian, maka saudara seayah perempuan menjadi terhalang (mahjub) dan tidak mendapat bagian sama sekali. Ini menunjukkan prinsip prioritas: yang lebih dekat nasabnya menghalangi yang lebih jauh." }
                            ]}
                        ]}
                    }
                ]
            },
            {
                id: 'bab4', title: 'Bab 4: Ahli Waris Pewaris Sisa (Asabah)',
                subChapters: [
                    {
                        id: 'sub4-1', title: '4.1 Definisi, Jenis, dan Hirarki Asabah',
                        content: `<p><strong>Definisi Asabah:</strong> Ahli waris yang tidak memiliki bagian tertentu (fardh). Mereka hanya mendapat bagian jika ada harta yang tersisa setelah semua ahli waris Ashabul Furudh menerima bagian mereka. Jika tidak ada sisa, mereka tidak mendapat apa-apa.</p><p><strong>Jenis-jenis Asabah:</strong> <strong>Asabah Binasab (Karena Keturunan):</strong> Ini adalah golongan utama. Contoh: Anak laki-laki, ayah, kakek, saudara laki-laki kandung, paman kandung, dll. <strong>Asabah Sabab (Karena Sebab):</strong> Hanya satu golongan, yaitu <strong>budak yang telah membebaskan tuannya</strong> (mu'allat).</p><p><strong>Hirarki Asabah:</strong> 1. Anak Laki-laki (dan keturunannya). 2. Ayah (dan kakek). 3. Saudara Laki-laki Kandung (dan keturunannya). 4. Saudara Seayah Laki-laki (dan keturunannya). 5. Paman Kandung (dan keturunannya). 6. Paman Seayah (dan keturunannya).</p><div class="example-box"><h4>üìñ Contoh Kasus Sebelum Asesmen</h4><p><strong>Skenario:</strong> Seorang mayit meninggalkan: seorang anak laki-laki, seorang ayah, seorang saudara laki-laki kandung, dan seorang paman kandung.</p><p><strong>Analisis:</strong> Anak laki-laki adalah 'asabah paling utama. Karena keberadaannya, ia menghalangi ayah, saudara laki-laki, dan paman untuk menjadi 'asabah. Ayah dalam kasus ini berperan sebagai Ashabul Furudh dengan bagian 1/6. Saudara laki-laki dan paman tidak mendapat bagian sama sekali.</p></div>`,
                        quiz: { questions: [
                            { type: 'multiple-choice', question: "Siapa yang termasuk Asabah Binasab?", options: ["Anak laki-laki", "Ibu", "Istri", "Anak perempuan tunggal"], correctAnswer: 0 },
                            { type: 'essay', question: "Jelaskan mengapa anak laki-laki menjadi 'asabah yang paling utama dan dapat menghalangi ayahnya sendiri untuk menjadi 'asabah, meskipun ayah adalah orang tuanya!", referenceAnswer: "Jawaban acuan: Karena dalam hukum waris, prioritas utama adalah melanjutkan garis keturunan. Anak laki-laki adalah perpanjangan tangan langsung dari si mayit. Jika anak laki-laki ada, maka garis keturunan sudah jelas dan diwakili olehnya. Ayah, meskipun orang tua, berperan sebagai penopang generasi di atasnya. Jika anak laki-laki tidak ada, barulah ayah 'turun tangan' menjadi pewaris utama ('asabah) untuk memastikan garis keturunan tidak putus." },
                            { type: 'matching', question: "Jodohkan 'asabah dengan urutan prioritasnya!", pairs: [{ term: "Anak laki-laki", match: "Prioritas 1" }, { term: "Ayah", match: "Prioritas 2" }, { term: "Saudara laki-laki kandung", match: "Prioritas 3" }, { term: "Paman kandung", match: "Prioritas 5" }, { term: "Anak dari saudara laki-laki", match: "Prioritas 3 (bersama saudara laki-laki)" }] },
                            { type: 'case-study', scenario: "Seorang mayit meninggalkan: seorang ibu, seorang kakek (dari pihak ayah), seorang saudara laki-laki kandung, dan seorang saudara seayah laki-laki.", questions: [
                                { type: 'multiple-choice', question: "Siapa yang menjadi 'asabah dan menerima sisa harta dalam kasus ini?", options: ["Kakek", "Saudara laki-laki kandung", "Saudara seayah laki-laki", "Saudara laki-laki kandung dan saudara seayah laki-laki (berbagi sisa)"], correctAnswer: 1 },
                                { type: 'essay', question: "Jelaskan bagian masing-masing ahli waris dan mengapa kakek serta saudara seayah tidak mendapat bagian sisa!", referenceAnswer: "Jawaban acuan: Ibu mendapat bagian 1/6. Karena tidak ada anak laki-laki dan ayah, maka 'asabah yang berhak adalah saudara laki-laki kandung. Kakek terhalang oleh saudara laki-laki kandung yang lebih dekat nasabnya ke mayit. Saudara seayah laki-laki juga terhalang oleh saudara kandung laki-laki. Jadi, setelah ibu mengambil 1/6, sisanya (5/6) akan diberikan seluruhnya kepada saudara laki-laki kandung sebagai 'asabah tunggal." }
                            ]},
                            { type: 'multiple-choice', question: "Seorang mayit meninggalkan seorang anak perempuan dan seorang saudara laki-laki kandung. Bagaimana pembagiannya?", options: ["Anak perempuan 1/2, saudara laki-laki 1/2", "Anak perempuan 1/3, saudara laki-laki 2/3", "Anak perempuan 1/2, saudara laki-laki 1/2 (sebagai 'asabah)", "Anak perempuan 1/2, sisanya untuk saudara laki-laki ('asabah)"], correctAnswer: 3 },
                            { type: 'essay', question: "Apa yang terjadi jika seorang mayit hanya meninggalkan dua orang paman (saudara kandung dari ayahnya)? Bagaimana pembagian hartanya?", referenceAnswer: "Jawaban acuan: Jika hanya ada dua paman, mereka berdua adalah 'asabah. Tidak ada ahli waris Ashabul Furudh lainnya. Oleh karena itu, seluruh harta akan dibagikan kepada kedua paman tersebut secara rata, masing-masing mendapat 1/2." },
                            { type: 'multiple-choice', question: "'Asabah Sabab adalah...", options: ["Anak laki-laki", "Ayah", "Budak yang membebaskan tuannya", "Paman"], correctAnswer: 2 },
                            { type: 'essay', question: "Jelaskan konsep 'ta'sib' dan 'ma'sum dalam konteks 'asabah. Apa bedanya dengan 'ashabah binasab?", referenceAnswer: "Jawaban acuan: 'Ta'sib adalah proses seseorang menjadi 'asabah. 'Ma'sum adalah ahli waris yang berhak menjadi 'asabah. 'Ashabah binasab adalah 'asabah karena sebab nasab (keturunan), seperti anak, ayah, saudara. 'Ashabah sabab adalah 'asabah karena sebab lain, seperti budak yang membebaskan tuannya. Perbedaannya terletak pada asal muasal hak warisnya: yang satu karena darah, yang lain karena jasa (pembebasan)." },
                            { type: 'matching', question: "Jodohkan kasus dengan 'asabah yang berhak!", pairs: [{ term: "Mayit meninggalkan anak laki-laki dan ayah", match: "Anak laki-laki" }, { term: "Mayit meninggalkan ibu dan saudara laki-laki kandung", match: "Saudara laki-laki kandung" }, { term: "Mayit meninggalkan kakek dan paman", match: "Kakek" }, { term: "Mayit meninggalkan saudara seayah dan paman", match: "Saudara seayah" }] },
                            { type: 'case-study', scenario: "Seorang laki-laki meninggal dunia. Ahli warisnya: seorang istri, seorang ibu, dan seorang cucu laki-laki (dari anak laki-lakinya yang sudah meninggal terlebih dahulu).", questions: [
                                { type: 'multiple-choice', question: "Siapa yang menjadi 'asabah dalam kasus ini?", options: ["Ibu", "Istri", "Cucu laki-laki", "Tidak ada 'asabah"], correctAnswer: 2 },
                                { type: 'essay', question: "Jelaskan konsep hukum yang membuat cucu laki-laki bisa menjadi 'asabah menggantikan posisi ayahnya yang sudah meninggal. Sebutkan nama konsep ini!", referenceAnswer: "Jawaban acuan: Konsep ini disebut <strong>Tanzihul Hubuth</strong> atau dalam bahasa Arab <strong>Tanzƒ´h al-·∏•ub≈´·π≠</strong>, yang berarti mencegah harta turun ke tingkat yang lebih rendah. Cucu laki-laki dianggap menempati posisi ayahnya (anak laki-laki si mayit) untuk mencegah harta waris jatuh kepada paman atau kerabat lain yang lebih jauh. Dengan demikian, cucu laki-laki tersebut menjadi 'asabah dan mewarisi sisa harta setelah istri dan ibu mendapat bagian mereka." }
                            ]}
                        ]}
                    }
                ]
            },
            {
                id: 'bab5', title: 'Bab 5: Praktik Pembagian & Kasus Khusus',
                subChapters: [
                    {
                        id: 'sub5-1', title: '5.1 Masalah Aul (Kekurangan Bagian)',
                        content: `<p><strong>'Aul</strong> terjadi ketika jumlah total bagian Ashabul Furudh lebih dari 1 (satu). Akibatnya, bagian masing-masing ahli waris harus dikurangi secara proporsional agar totalnya menjadi 1. Ini adalah 'keajaiban' matematika dalam Al-Qur'an.</p><p><strong>Contoh Kasus 'Aul:</strong> Mayit meninggalkan: Suami (1/4), 2 orang ibu (1/3), dan 2 orang saudara perempuan kandung (2/3). Total bagian = 1/4 + 1/3 + 2/3 = 1 1/4. Karena total > 1, terjadi 'aul. Semua bagian harus dikurangi.</p><div class="example-box"><h4>üìñ Contoh Kasus Sebelum Asesmen</h4><p><strong>Skenario:</strong> Seorang mayit meninggalkan: seorang istri, seorang ibu, dua orang saudara kandung perempuan, dan seorang ayah.</p><p><strong>Analisis:</strong> Istri (1/8), Ibu (1/6), 2 Saudara Perempuan (2/3), Ayah ('Asabah). Total bagian Furudh = 1/8 + 1/6 + 2/3 = 1 + 1/8. Terjadi 'aul. Total asal = 1 + 1/8 = 9/8. Bagian akhir Istri = (1/8)/(9/8) = 1/9. Ibu = (1/6)/(9/8) = 4/27. 2 Saudara Perempuan = (2/3)/(9/8) = 16/27. Ayah mendapat sisa setelah 'aul, yaitu 1 - (1/9 + 4/27 + 16/27) = 2/27.</p></div>`,
                        quiz: { questions: [
                            { type: 'multiple-choice', question: "Kapan terjadi masalah 'Aul?", options: ["Ketika total bagian kurang dari 1", "Ketika total bagian lebih dari 1", "Ketika tidak ada 'Asabah", "Ketika mayit tidak punya ahli waris"], correctAnswer: 1 },
                            { type: 'essay', question: "Jelaskan bagaimana cara menghitung pembagian harta jika terjadi masalah 'Aul. Berikan contoh perhitungan sederhana!", referenceAnswer: "Jawaban acuan: Cara menghitung 'aul adalah dengan mengalikan setiap bagian dengan bilangan pokok (hasil dari 1 dibagi total bagian asal). Contoh: Mayit meninggalkan suami (1/2) dan dua saudara perempuan (2/3). Total asal = 1/2 + 2/3 = 7/6. Bilangan pokok = 1 / (7/6) = 6/7. Bagian akhir suami = 1/2 * 6/7 = 3/7. Bagian akhir masing-masing saudara perempuan = (1/3) * 6/7 = 2/7." },
                            { type: 'matching', question: "Jodohkan ahli waris dengan bagian yang menyebabkan 'aul!", pairs: [{ term: "Suami, Ibu, 2 Saudara Perempuan", match: "Total > 1" }, { term: "Istri, Ayah, Ibu, Anak Perempuan", match: "Total > 1" }, { term: "Suami, Ibu, Anak Laki-laki", match: "Total < 1" }, { term: "Istri, 2 Saudara Perempuan", match: "Total = 1" }] },
                            { type: 'case-study', scenario: "Seorang mayit meninggalkan: seorang istri, seorang ayah, seorang ibu, dan seorang anak perempuan.", questions: [
                                { type: 'multiple-choice', question: "Apakah dalam kasus ini terjadi 'aul, 'radd, atau tidak ada keduanya?", options: ["'Aul", "'Radd", "Tidak ada keduanya", "Tidak bisa ditentukan"], correctAnswer: 0 },
                                { type: 'essay', question: "Hitunglah bagian masing-masing ahli waris setelah penyesuaian ('aul)!", referenceAnswer: "Jawaban acuan: Bagian Furudh: Istri (1/8), Ayah (1/6), Ibu (1/6), Anak Perempuan (1/2). Total asal = 13/12. Bilangan pokok = 12/13. Bagian akhir Istri = 1/8 * 12/13 = 3/26. Ayah = 1/6 * 12/13 = 2/13. Ibu = 1/6 * 12/13 = 2/13. Anak Perempuan = 1/2 * 12/13 = 6/13." }
                            ]},
                            { type: 'multiple-choice', question: "Mayit meninggalkan suami, ibu, dan2 saudara kandung perempuan. Total bagian awalnya adalah...", options: ["1", "7/6", "13/12", "23/24"], correctAnswer: 2 },
                            { type: 'essay', question: "Siapa saja ahli waris yang bagiannya bisa berkurang saat terjadi 'aul?", referenceAnswer: "Jawaban acuan: Semua ahli waris Ashabul Furudh yang mendapat bagian dalam kasus tersebut, bagian mereka akan berkurang secara proporsional. Tidak ada yang kebal dari 'aul. Jadi, suami, istri, ayah, ibu, anak perempuan, saudara perempuan, dll, semua bisa terkena 'aul jika jumlah total bagian mereka melebihi 1." },
                            { type: 'multiple-choice', question: "Mayit meninggalkan istri, ayah, dan ibu. Total bagian awalnya adalah 1/8 + 1/6 + 1/6 = 7/24. Apa yang terjadi?", options: ["Terjadi 'aul", "Terjadi 'radd", "Tidak ada keduanya, sisanya untuk 'asabah", "Pembagian tidak valid"], correctAnswer: 2 },
                            { type: 'essay', question: "Jelaskan hikmah di balik adanya konsep 'aul dalam hukum waris Islam!", referenceAnswer: "Jawaban acuan: Hikmah 'aul adalah untuk menyelesaikan masalah ketika bagian yang ditetapkan Allah (dalam Al-Qur'an) secara matematis saling tumpang tindih sehingga totalnya melebihi 1. Daripada membatalkan beberapa bagian atau menimbulkan ketidakadilan, Islam memberikan solusi ilmiah yang adil dengan mengurangi semua bagian secara proporsional." },
                            { type: 'matching', question: "Jodohkan kasus dengan total bagian awalnya!", pairs: [{ term: "Suami (1/2), Ibu (1/3)", match: "5/6" }, { term: "Istri (1/4), Ayah (1/6), Ibu (1/6)", match: "7/12" }, { term: "Suami (1/4), Ibu (1/3), 2 Saudara Perempuan (2/3)", match: "1 1/4" }, { term: "Istri (1/8), Ayah (1/6), Ibu (1/6), Anak Perempuan (1/2)", match: "13/12" }] },
                            { type: 'case-study', scenario: "Seorang mayit meninggalkan: seorang istri, seorang ibu, seorang anak perempuan, dan seorang saudara kandung perempuan.", questions: [
                                { type: 'multiple-choice', question: "Siapa yang mendapat bagian terbesar setelah 'aul?", options: ["Istri", "Ibu", "Anak Perempuan", "Saudara Kandung Perempuan"], correctAnswer: 2 },
                                { type: 'essay', question: "Hitunglah total bagian awal dan tentukan bilangan pokoknya!", referenceAnswer: "Jawaban acuan: Bagian Furudh: Istri (1/8), Ibu (1/6), Anak Perempuan (1/2). Saudara kandung perempuan 'ashabah. Total bagian Furudh = 17/24. Karena ada 'ashabah, ini bukan kasus 'aul murni. Tapi jika kita asumsikan semua dapat bagian (untuk latihan), total = 17/24 + 1/6 (asumsi saudara perempuan dapat 1/6) = 21/24 = 7/8. Ini < 1, jadi 'radd. Kasus 'aul yang benar adalah jika total > 1. Contoh: Istri(1/8), Ibu(1/6), 2 Saudara Perempuan(2/3). Total = 13/12. Bilangan pokok = 12/13." }
                            ]}
                        ]}
                    }
                ]
            }
        ];

        // --- APLIKASI LOGIKA ---
        let currentChapterId = null, currentSubChapterId = null;
        let quizState = { questions: [], currentQuestionIndex: 0, score: 0, totalPossibleScore: 0 };
        let caseStudyState = { answeredSubQuestions: new Set() };

        const views = document.querySelectorAll('.view');
        const storage = {
            get: (key) => { const data = localStorage.getItem(key); return data ? JSON.parse(data) : null; },
            set: (key, value) => localStorage.setItem(key, JSON.stringify(value)),
            getProgress: () => storage.get('mawarisProgress') || {},
            saveProgress: (progress) => storage.set('mawarisProgress', progress),
            markCompleted: (type, id) => { const p = storage.getProgress(); if (!p[type]) p[type] = {}; p[type][id] = true; storage.saveProgress(p); },
            isCompleted: (type, id) => { const p = storage.getProgress(); return !!(p[type] && p[type][id]); },
            getQuizScores: () => storage.get('mawarisQuizScores') || {},
            saveQuizScore: (id, score, total) => { const s = storage.getQuizScores(); s[id] = { score: score, total: total }; storage.set('mawarisQuizScores', s); },
            getUserName: () => storage.get('mawarisUserName') || 'Pengguna',
            saveUserName: (name) => storage.set('mawarisUserName', name)
        };

        function showView(viewId) { views.forEach(v => v.classList.remove('active')); document.getElementById(viewId).classList.add('active'); }
        
        function renderDashboard() {
            const chapterList = document.getElementById('chapter-list'); chapterList.innerHTML = '';
            const userName = storage.getUserName();
            if (!userName) { showView('welcome-view'); return; }
            courseData.forEach(chapter => {
                const card = document.createElement('div'); card.className = 'chapter-card';
                card.innerHTML = `<h3>${chapter.title}</h3>`;
                const list = document.createElement('ul'); list.className = 'sub-chapter-list';
                chapter.subChapters.forEach(sub => {
                    const item = document.createElement('li'); item.className = 'sub-chapter-item';
                    const isLessonDone = storage.isCompleted('lessons', sub.id);
                    const isQuizDone = storage.isCompleted('quizzes', sub.id);
                    if (isLessonDone && isQuizDone) item.classList.add('completed');
                    item.innerHTML = `<a href="#">${sub.title}</a><span class="status-icon">${(isLessonDone && isQuizDone) ? '‚úÖ' : '‚è≥'}</span>`;
                    item.querySelector('a').onclick = (e) => { e.preventDefault(); showLesson(chapter.id, sub.id); };
                    list.appendChild(item);
                });
                card.appendChild(list); chapterList.appendChild(card);
            });
            updateProgressBar(); checkCompletionStatus(); showView('dashboard-view');
        }
        function updateProgressBar() {
            const totalSubChapters = courseData.reduce((acc, ch) => acc + ch.subChapters.length, 0);
            const progress = storage.getProgress();
            const completedLessons = Object.keys(progress.lessons || {}).length;
            const completedQuizzes = Object.keys(progress.quizzes || {}).length;
            const totalTasks = totalSubChapters * 2;
            const completedTasks = completedLessons + completedQuizzes;
            const percentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            const progressBar = document.getElementById('progress-bar');
            progressBar.style.width = `${percentage}%`; progressBar.textContent = `${percentage}%`;
        }
        function checkCompletionStatus() {
            const totalSubChapters = courseData.reduce((acc, ch) => acc + ch.subChapters.length, 0);
            const progress = storage.getProgress();
            const completedQuizzes = Object.keys(progress.quizzes || {}).length;
            document.getElementById('certificate-button-container').style.display = (completedQuizzes === totalSubChapters) ? 'block' : 'none';
        }

        function showLesson(chapterId, subChapterId) {
            currentChapterId = chapterId; currentSubChapterId = subChapterId;
            const chapter = courseData.find(ch => ch.id === chapterId);
            const subChapter = chapter.subChapters.find(sub => sub.id === subChapterId);
            document.getElementById('lesson-title').textContent = subChapter.title;
            document.getElementById('lesson-content').innerHTML = subChapter.content;
            showView('lesson-view'); storage.markCompleted('lessons', subChapterId);
        }

        function startQuiz() {
            const chapter = courseData.find(ch => ch.id === currentChapterId);
            const subChapter = chapter.subChapters.find(sub => sub.id === currentSubChapterId);
            quizState.questions = subChapter.quiz.questions;
            quizState.currentQuestionIndex = 0;
            quizState.score = 0;
            quizState.totalPossibleScore = calculateTotalPossibleScore(quizState.questions);
            caseStudyState.answeredSubQuestions = new Set(); // Reset case study state

            document.getElementById('quiz-title').textContent = `Asesmen: ${subChapter.title}`;
            document.getElementById('back-to-dashboard-quiz').style.display = 'none';
            document.getElementById('quiz-result').style.display = 'none';
            document.getElementById('quiz-container').style.display = 'block';
            
            renderQuestion();
            showView('quiz-view');
        }

        function calculateTotalPossibleScore(questions) {
            let score = 0;
            questions.forEach(q => {
                if (q.type === 'multiple-choice' || q.type === 'essay') score += 1;
                else if (q.type === 'matching') score += q.pairs.length;
                else if (q.type === 'case-study') {
                    q.questions.forEach(cq => {
                        if (cq.type === 'multiple-choice' || cq.type === 'essay') score += 1;
                    });
                }
            });
            return score;
        }

        function renderQuestion() {
            if (quizState.currentQuestionIndex >= quizState.questions.length) { showQuizResult(); return; }
            const question = quizState.questions[quizState.currentQuestionIndex];
            const progressInfo = `Soal ${quizState.currentQuestionIndex + 1} / ${quizState.questions.length}`;
            document.getElementById('quiz-progress-info').textContent = progressInfo;
            
            document.getElementById('quiz-options').style.display = 'none';
            document.getElementById('quiz-essay-container').style.display = 'none';
            document.getElementById('quiz-matching-container').style.display = 'none';
            document.getElementById('quiz-case-study-container').style.display = 'none';

            switch(question.type) {
                case 'multiple-choice': renderMultipleChoice(question); break;
                case 'essay': renderEssay(question); break;
                case 'matching': renderMatching(question); break;
                case 'case-study': renderCaseStudy(question); break;
            }
        }
        
        function renderMultipleChoice(question) {
            document.getElementById('quiz-options').style.display = 'block';
            document.getElementById('question-text').textContent = question.question;
            const optionsContainer = document.getElementById('quiz-options');
            optionsContainer.innerHTML = '';
            question.options.forEach((option, index) => {
                const li = document.createElement('li'); li.className = 'quiz-option'; li.textContent = option;
                li.onclick = () => selectAnswer(index, question.correctAnswer);
                optionsContainer.appendChild(li);
            });
        }

        function renderEssay(question) {
            document.getElementById('quiz-essay-container').style.display = 'block';
            document.getElementById('question-text').textContent = question.question;
            const container = document.getElementById('quiz-essay-container');
            container.innerHTML = `
                <textarea id="essay-answer" placeholder="Ketik jawaban Anda di sini..."></textarea>
                <button id="show-reference-btn" class="btn btn-warning">Lihat Jawaban Acuan</button>
                <div id="reference-answer" class="essay-reference">
                    <strong>Jawaban Acuan:</strong><p>${question.referenceAnswer}</p>
                    <button id="mark-essay-done-btn" class="btn btn-success">Tandai Selesai & Lanjut</button>
                </div>
            `;
            document.getElementById('show-reference-btn').onclick = () => { document.getElementById('reference-answer').style.display = 'block'; };
            document.getElementById('mark-essay-done-btn').onclick = () => { quizState.score++; quizState.currentQuestionIndex++; renderQuestion(); };
        }

        function renderMatching(question) {
            document.getElementById('quiz-matching-container').style.display = 'block';
            document.getElementById('question-text').textContent = question.question;
            const container = document.getElementById('quiz-matching-container');
            container.innerHTML = `<div class="matching-container"></div><button id="check-matching-btn" class="btn btn-primary">Cocokkan Jawaban</button>`;
            const matchingContainer = container.querySelector('.matching-container');
            const matches = {};
            question.pairs.forEach((pair, index) => {
                matches[pair.term] = pair.match;
                const itemDiv = document.createElement('div'); itemDiv.className = 'matching-item';
                itemDiv.innerHTML = `<label>${pair.term}:</label><select data-term="${pair.term}"><option value="">-- Pilih --</option></select>`;
                matchingContainer.appendChild(itemDiv);
            });
            const allMatches = [...new Set(question.pairs.map(p => p.match))];
            document.querySelectorAll('#quiz-matching-container select').forEach(select => {
                allMatches.forEach(match => {
                    const option = document.createElement('option'); option.value = match; option.textContent = match;
                    select.appendChild(option);
                });
            });
            document.getElementById('check-matching-btn').onclick = () => {
                let correctCount = 0;
                document.querySelectorAll('#quiz-matching-container select').forEach(select => {
                    const term = select.dataset.term;
                    const userAnswer = select.value;
                    if (userAnswer === matches[term]) { select.style.borderColor = 'var(--success-color)'; correctCount++; }
                    else { select.style.borderColor = 'var(--danger-color)'; }
                });
                quizState.score += correctCount;
                setTimeout(() => { quizState.currentQuestionIndex++; renderQuestion(); }, 2000);
            };
        }

        function renderCaseStudy(question) {
            document.getElementById('quiz-case-study-container').style.display = 'block';
            const container = document.getElementById('quiz-case-study-container');
            container.innerHTML = `<div class="case-study-scenario"><strong>Skenario:</strong><br>${question.scenario}</div>`;
            const subQuestionsContainer = document.createElement('div');
            subQuestionsContainer.id = 'sub-questions-container';
            question.questions.forEach((subQ, index) => {
                const subQDiv = document.createElement('div'); subQDiv.className = 'case-study-sub-question';
                subQDiv.innerHTML = `<p><strong>${index + 1}. ${subQ.question}</strong></p>`;
                if (subQ.type === 'multiple-choice') {
                    const optionsList = document.createElement('ul'); optionsList.className = 'quiz-options';
                    subQ.options.forEach((opt, i) => {
                        const li = document.createElement('li'); li.className = 'quiz-option'; li.textContent = opt;
                        li.onclick = () => selectSubAnswer(index, i, subQ.correctAnswer);
                        optionsList.appendChild(li);
                    });
                    subQDiv.appendChild(optionsList);
                } else if (subQ.type === 'essay') {
                    subQDiv.innerHTML += `
                        <textarea id="case-essay-${index}" placeholder="Ketik jawaban Anda..."></textarea>
                        <button class="btn btn-warning" onclick="showCaseEssayRef(${index})">Lihat Acuan</button>
                        <div id="case-ref-${index}" class="essay-reference" style="display:none;"><strong>Acuan:</strong><p>${subQ.referenceAnswer}</p><button class="btn btn-success" onclick="markCaseEssayDone(${index})">Selesai</button></div>
                    `;
                }
                subQuestionsContainer.appendChild(subQDiv);
            });
            container.appendChild(subQuestionsContainer);
            // Add next button for case study
            const nextButtonContainer = document.createElement('div');
            nextButtonContainer.id = 'case-study-next-btn-container';
            nextButtonContainer.style.marginTop = '20px';
            nextButtonContainer.innerHTML = `<button id="next-question-btn" class="btn btn-primary" disabled>Lanjut ke Soal Berikutnya</button>`;
            container.appendChild(nextButtonContainer);
            
            document.getElementById('next-question-btn').onclick = () => {
                quizState.currentQuestionIndex++;
                renderQuestion();
            };
            
            document.getElementById('question-text').textContent = 'Analisislah skenario berikut dengan cermat.';
        }
        
        function selectSubAnswer(qIndex, aIndex, correctAnswer) {
            const options = document.querySelectorAll(`#sub-questions-container .case-study-sub-question:nth-of-type(${qIndex + 1}) .quiz-option`);
            options.forEach(o => o.classList.add('disabled'));
            if (aIndex === correctAnswer) { options[aIndex].classList.add('correct'); quizState.score++; }
            else { options[aIndex].classList.add('incorrect'); options[correctAnswer].classList.add('correct'); }
            caseStudyState.answeredSubQuestions.add(qIndex);
            checkCaseStudyCompletion();
        }
        function showCaseEssayRef(index) { document.getElementById(`case-ref-${index}`).style.display = 'block'; }
        function markCaseEssayDone(index) {
            quizState.score++;
            caseStudyState.answeredSubQuestions.add(index);
            document.getElementById(`case-ref-${index}`).querySelector('.btn-success').disabled = true;
            checkCaseStudyCompletion();
        }

        function checkCaseStudyCompletion() {
            const currentQuestion = quizState.questions[quizState.currentQuestionIndex];
            const totalSubQuestions = currentQuestion.questions.length;
            const nextButton = document.getElementById('next-question-btn');
            if (caseStudyState.answeredSubQuestions.size === totalSubQuestions) {
                nextButton.disabled = false;
            }
        }

        function selectAnswer(selectedIndex, correctAnswer) {
            const options = document.querySelectorAll('.quiz-option');
            options.forEach(option => option.classList.add('disabled'));
            if (selectedIndex === correctAnswer) { options[selectedIndex].classList.add('correct'); quizState.score++; }
            else { options[selectedIndex].classList.add('incorrect'); options[correctAnswer].classList.add('correct'); }
            setTimeout(() => { quizState.currentQuestionIndex++; renderQuestion(); }, 1500);
        }

        function showQuizResult() {
            document.getElementById('quiz-container').style.display = 'none';
            document.getElementById('back-to-dashboard-quiz').style.display = 'inline-block';
            const resultContainer = document.getElementById('quiz-result');
            resultContainer.style.display = 'block';
            resultContainer.innerHTML = `
                <h3>üéâ Asesmen Selesai!</h3>
                <p>Anda mendapat skor <strong>${quizState.score} dari ${quizState.totalPossibleScore}</strong>.</p>
                <p>${quizState.score === quizState.totalPossibleScore ? 'Luar biasa! Anda sempurna.' : 'Bagus! Terus belajar untuk hasil yang lebih baik.'}</p>
            `;
            storage.saveQuizScore(currentSubChapterId, quizState.score, quizState.totalPossibleScore);
            storage.markCompleted('quizzes', currentSubChapterId);
        }

        function showCertificate() {
            const userName = storage.getUserName();
            const scores = storage.getQuizScores();
            let totalScore = 0, totalPossible = 0;
            courseData.forEach(ch => {
                ch.subChapters.forEach(sub => {
                    if (scores[sub.id]) {
                        totalScore += scores[sub.id].score;
                        totalPossible += scores[sub.id].total;
                    }
                });
            });
            const finalPercentage = totalPossible > 0 ? Math.round((totalScore / totalPossible) * 100) : 0;
            document.getElementById('certificate-name').textContent = userName;
            document.getElementById('certificate-score').textContent = `${finalPercentage}% (${totalScore}/${totalPossible} poin)`;
            document.getElementById('certificate-date').textContent = new Date().toLocaleDateString('id-ID');
            showView('certificate-view');
        }

        // --- EVENT LISTENERS (Dimuat setelah DOM siap) ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('start-learning-btn').onclick = () => {
                const name = document.getElementById('user-name-input').value.trim();
                if (name) { storage.saveUserName(name); renderDashboard(); } else { alert('Silakan masukkan nama Anda.'); }
            };
            document.getElementById('back-to-dashboard-lesson').onclick = () => renderDashboard();
            document.getElementById('back-to-dashboard-quiz').onclick = () => renderDashboard();
            document.getElementById('back-to-dashboard-cert').onclick = () => renderDashboard();
            document.getElementById('start-quiz-btn').onclick = startQuiz;
            document.getElementById('view-certificate-btn').onclick = showCertificate;
            document.getElementById('print-certificate-btn').onclick = () => window.print();

            const userName = storage.getUserName();
            if (userName) { renderDashboard(); } else { showView('welcome-view'); }
        });

    </script>
</body>
</html>
